<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at May 4, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>Mock framework</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
        <style>body{padding-top: 20px;}</style>
    
      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
      <meta name="author" content="Marco Speranza and Simone Tripodi" />
    <meta name="Date-Revision-yyyymmdd" content="20120504" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
  <body>
      
        
    
        <div class="container-fluid">
          
      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 04 May 2012</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.3</li>
                      
                
                    
      
                  </ul>
      </div>

            <div id="leftColumn" class="sidebar">
        <div class="well">
                
                    
                                   <h5>JUnice</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="core.html" title="The core - JUniceRunner">The core - JUniceRunner</a>
            </li>
                  <li class="none">
                          <a href="guice.html" title="Guice integration">Guice integration</a>
            </li>
                  <li class="none">
            <strong>Mock Framework integration</strong>
          </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>External Links</h5>
                  <ul>
                  <li class="none">
                          <a href="http://code.google.com/p/junice/" class="externalLink" title="Project Page">Project Page</a>
            </li>
                  <li class="none">
                          <a href="http://code.google.com/p/google-guice/" class="externalLink" title="Google Guice">Google Guice</a>
            </li>
                  <li class="none">
                          <a href="http://www.junit.org" class="externalLink" title="JUnit">JUnit</a>
            </li>
                  <li class="none">
                          <a href="http://easymock.org/" class="externalLink" title="Easy-Mock">Easy-Mock</a>
            </li>
                  <li class="none">
                          <a href="http://mockito.org/" class="externalLink" title="Mockito">Mockito</a>
            </li>
          </ul>
                       <h5>99soft</h5>
                  <ul>
                  <li class="none">
                          <a href="../" title="Home">Home</a>
            </li>
                                                                                <li class="expanded">
                          <a href="../maven.html" title="Apache Maven Plugins">Apache Maven Plugins</a>
                    <ul>
                      <li class="none">
                          <a href="../fluido-skin" title="fluido-skin">fluido-skin</a>
            </li>
                      <li class="none">
                          <a href="../solr-packager" title="solr-packager">solr-packager</a>
            </li>
              </ul>
        </li>
                                                                                                                    <li class="expanded">
                          <a href="../commons.html" title="Common tools">Common tools</a>
                    <ul>
                      <li class="none">
                          <a href="../backport-spi" title="backport-spi">backport-spi</a>
            </li>
                      <li class="none">
                          <a href="../Hazelmap" title="Hazelmap">Hazelmap</a>
            </li>
                      <li class="none">
                          <a href="../meiyo" title="meiyo">meiyo</a>
            </li>
                      <li class="none">
                          <a href="../miyamoto" title="miyamoto">miyamoto</a>
            </li>
              </ul>
        </li>
                                                                                                  <li class="expanded">
                          <a href="../guice.html" title="Google Guice Integrations">Google Guice Integrations</a>
                    <ul>
                      <li class="none">
                          <a href="../guartz" title="Guartz">Guartz</a>
            </li>
                      <li class="none">
                          <a href="../rocoto" title="Rocoto">Rocoto</a>
            </li>
                      <li class="none">
                          <a href="../sli4j" title="sli4j">sli4j</a>
            </li>
              </ul>
        </li>
                                                                                                  <li class="expanded">
                          <a href="../semweb.html" title="Semantic Web">Semantic Web</a>
                    <ul>
                      <li class="none">
                          <a href="../sameas4j" title="sameas4j">sameas4j</a>
            </li>
                      <li class="none">
                          <a href="../t2t" title="t2t">t2t</a>
            </li>
                      <li class="none">
                          <a href="../be3" title="be3">be3</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="../volunteering.html" title="Volunteering">Volunteering</a>
            </li>
                  <li class="none">
                          <a href="../patches.html" title="Contributing Patches">Contributing Patches</a>
            </li>
                  <li class="none">
                          <a href="../getinvolved.html" title="Get Involved">Get Involved</a>
            </li>
          </ul>
                      
                    
                
            
          <div id="poweredBy">
                            <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                </div>
        </div>
      </div>
      
      <div id="bodyColumn" class="content">
        <div id="contentBox">
                              
          <!--  --><!-- Copyright 2012 The 99 Software Foundation --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><!-- author: Marco Speranza --><!-- version: $Id: index.apt 924 2009-12-31 10:11:36Z  marco.speranza79 $ --><div class="section"><h2>Mock framework<a name="Mock_framework"></a></h2><p><i>JUnice</i> integrates two <i>Mock frameworks</i> integrated with <i>Google Guice</i> to inject the mocked object into bussines logic classes, simply by annotating a test fild with <tt>@org.nnsoft.guice.junice.mock.annotation.Mock</tt> annotation. All existing bindins will be replaced with mock object declared into your test class.</p><p>JUnice supports this kind of mock:</p><ul><li>Easy-Mock (<tt>org.nnsoft.guice.junice.mock.annotation.MockType.EASY_MOCK</tt>)</li><li>Mockito (<tt>org.nnsoft.guice.junice.mock.annotation.MockType.MOCKITO</tt>)<p><b>by default</b> JUnice creates Easy-Mock mock objects.</p></li></ul><div class="section"><h3>Choose your favorite mock framework<a name="Choose_your_favorite_mock_framework"></a></h3><p>To choose a different mock framework that <i>JUnice</i> shuld be used to create your mock object, you should annotate the test classes in this way:</p><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
@MockFramework(type=MockType.MOCKITO)
public class SimpleTest {

}</pre></div></div><div class="section"><h3>Mock annotation<a name="Mock_annotation"></a></h3><p><tt>org.nnsoft.guice.junice.annotation.Mock</tt> is a field annotation used by core <i>Runner</i> to instantiate and inject Mock object into a test case class.</p><p><tt>org.nnsoft.guice.junice.annotation.Mock</tt> can be configured with this parameters:</p><table border="1" class="zebra-striped"><tr class="a"><th align="left">Property</th><th align="left">Type</th><th align="left">Description</th></tr><tr class="b"><td align="left"><b>providedBy</b></td><td align="left"><tt>java.lang.String</tt></td><td align="left">Specifies a <tt>java.lang.String</tt> that indentifies a <b>public static</b> method with return type is equals to the type of the field annotated by this annotation.</td></tr><tr class="a"><td align="left"><b>providerClass</b></td><td align="left"><tt>Class</tt></td><td align="left">If present specifies a <tt>Class</tt> that contains the method <tt>providedBy</tt>, by default<tt>providerClass</tt> is setted with filed declared class</td></tr><tr class="b"><td align="left"><b>reserAfter</b></td><td align="left">boolean</td><td align="left"><b>true</b> (default) specifies a boolean value to reset this mock object after any test method.</td></tr><tr class="a"><td align="left"><b>annotateWith</b></td><td align="left"><tt>Class</tt></td><td align="left">Specifies an annotaion <tt>Class</tt> that will be used in the <tt>Google Guice</tt> binder to execute the literal binding.</td></tr><tr class="b"><td align="left"><b>namedWith</b></td><td align="left"><tt>String</tt></td><td align="left">Specifies an annotaion <tt>String&gt;&gt; that will be used in the &lt;&lt;&lt;Google Guice</tt> binder to execute the literal binding.</td></tr><tr class="a"><td align="left"><b>type</b></td><td align="left"><tt>org.nnsoft.guice.junice.annotation.MockObjType</tt></td><td align="left">Specifies the mock type.</td></tr></table><p>In the following example <i>HelloWorld</i> class dependencies will be injected with the mocked class created by the <i>Runner</i>:</p><div class="source"><pre class="prettyprint">
public class HelloWorld {

    @Inject
    private Service service;

    ...

    public String sayHalloByService() {
        return service.go();
    }

    ...
}</pre></div><p>Then, in the test class:</p><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
public class SimpleTest {

    //Create and inject a simple EasyMock Strict mock
    @org.nnsoft.guice.junice.annotation.Mock
    private Service service;

    @Inject
    private HelloWorld helloWorld;

    @Test
    public void testMock(){
        //Stub created mock
        EasyMock.expect(service.go()).andReturn(&quot;Ciao&quot;);
        EasyMock.replay(providedMock);

        assertNotNull(service);
        assertEquals(&quot;Ciao&quot;, helloWorld.sayHalloByService());

        EasyMock.verify(service);
    }

}</pre></div><div class="section"><h4>Mock resetAfter<a name="Mock_resetAfter"></a></h4><p><b>Note</b> The runner will reset any mock object after each test method. To indicate that a mock has to be resetted manually, fields must to be annotated in this way:</p><div class="source"><pre class="prettyprint">
    ...

    @Mock(resetAfter=false)
    private Service service;

    ...</pre></div></div><div class="section"><h4>Mock provider<a name="Mock_provider"></a></h4><p>The Runner class create a simple mock for each <tt>@Mock</tt> annotated filed. You shuld delegate the mock creation to a method in this way:</p><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
public class SimpleTest {

  @Mock(providedBy=&quot;providerMethod&quot;)
  private Service service;

  public static Service providerMethod() {
    Service mocked = EasyMock.createNiceMock(Service.class);

    ...

    return mockedService;
  }

  ...

}</pre></div><p>It's possible also delegate an external class:</p><div class="source"><pre class="prettyprint">
public class ServiceMockProvider {

  public static Service providerMethod() {
    Service mocked = EasyMock.createNiceMock(Service.class);

    ...

    return mockedService;
  }
}</pre></div><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
public class SimpleTest {

    @Mock(providedBy=&quot;providerMethod&quot;,
                      providerClass=ServiceMockProvider.class)
    private Service service;

    ...
}</pre></div></div><div class="section"><h4>Mock type<a name="Mock_type"></a></h4><p>The Runner class create a simple mock for each <tt>@Mock</tt> annotated filed. It's possible specify witch type of mock that the Runner creates. The possible values are:</p><ul><li>EASY_MOCK_NORMAL to create a normal EasyMock object mock (default value)</li><li>EASY_MOCK_STRICT to create a strict EasyMock object mock</li><li>EASY_MOCK_NICE to create a nice EasyMock object mock</li></ul></div></div><div class="section"><h3>Replace module<a name="Replace_module"></a></h3><p><i>JUnice</i> core <i>Runner</i> will replace all existing bindings found into modules declared via <tt>@org.nnsoft.guice.junice.annotation.GuiceModule</tt> and <tt>@org.nnsoft.guice.junice.annotation.GuiceProvidedModules</tt> with mocked object annotated with <tt>org.nnsoft.guice.junice.annotation.Mock</tt></p><p>So given google-guice module:</p><div class="source"><pre class="prettyprint">
public class ServiceModule extends AbstractModule {

    @Override
    protected void configure() {
        bind(Service.class)
            .to(ServiceImpl.class)
                .asEagerSingleton();
        ...
    }
}</pre></div><p>and your implementation</p><div class="source"><pre class="prettyprint">
public class ServiceImpl implements Service {

    public String go() {
        return &quot;It's real class&quot;;
    }

}</pre></div><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
@GuiceModules(modules=ServiceModule.class)
public class TestCustomInjectionTest {

    @Mock
    private static Service service;

    @Test
    public void testOverideModule() throws Exception {
        assertNotNull(service);

        EasyMock.expect(service.go())
                .andReturn(&quot;Mocked injected class&quot;);

        assertEquals(&quot;Mocked injected class&quot;, service.go());
    }

}
</pre></div><p>service instance will be injected with the mocked object.</p></div><div class="section"><h3>Multiple annotation for same type<a name="Multiple_annotation_for_same_type"></a></h3><p>It's possible annotate multiple types with the <tt>org.nnsoft.guice.junice.annotation.Mock</tt> annotation</p><p>The Method <tt>GuiceMockModule#configure()</tt> creates a binding for each <tt>org.nnsoft.guice.junice.annotation.Mock</tt> found. The binding will be created <b>if and only if</b> there is no types conflict beetween declared <tt>org.nnsoft.guice.junice.annotation.Mock</tt>.</p><p>A type conflict is detected</p><ul><li>if two or more field are annotated with the same <tt>org.nnsoft.guice.junice.annotation.Mock</tt> and no different <tt>org.nnsoft.guice.junice.annotation.Mock#annotatedWith</tt> parameter are specified for these annotation or,</li><li>two, or more, equals <tt>org.nnsoft.guice.junice.annotation.Mock#annotatedWith</tt> parameter are specified for the same type field.<p>If a conflict is detected the <b>binding will not be created</b> for this conflicted type, and the field will be injected <b>only</b> into the test class. So if necessary you have to create a proper binding for this <tt>org.nnsoft.guice.junice.annotation.Mock</tt> field:</p><div class="source"><pre class="prettyprint">
@RunWith(JUniceRunner.class)
public class TestCustomInjectionTest extendes Module {

    public void configure(Binder binder) {
        binder.bind(Service.class).toInstance(serviceOne);
    }

    @Mock
    private static Service serviceOne;

    @Mock
    private Service serviceTwo;

    @Inject
    private HelloWorld helloWorld;

    @Test
    public void testOverideModule() throws Exception {
        assertNotNull(serviceOne);
        assertNotNull(serviceTwo);
    }
}</pre></div></li></ul><p>in this case <tt>HelloWorld</tt> class has a dependency with <tt>Service</tt> interface. If you dont specify a proper binding <tt>Google Guice</tt> raises an <tt>com.google.inject.ConfigurationExcepion</tt>.</p></div></div>
                  </div>
      </div>
    </div>

    <footer class="footer">
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                    2010-2012
                        <a href="http://www.99soft.org/">99 Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
